name: schulddossier

image:
  registry: saks01weuacrpgpgo5qvmwo.azurecr.io
  tag: latest

labels:
  app-phpfpm: schulddossier-phpfpm
  app-nginx: schulddossier-nginx

network:
  allow-ingress:
    selector: app == 'schulddossier-phpfpm'
    ingress:
      - action: Allow
    egress:
      - action: Allow

deployments:
  schulddossier-phpfpm:
    securityContext:
      runAsUser: 82
    image:
      repository: salmagundi/schulddossier-phpfpm
    selectorLabels:
      app-phpfpm: schulddossier-phpfpm

    containers:
      - name: main
        ports:
          - port: 8080
            name: http
  schulddossier-nginx:
    image:
      repository: salmagundi/schulddossier-nginx
    selectorLabels:
      app-nginx: schulddossier-nginx
    containers:
      - name: main
        ports:
          - port: 8080
            name: http

services:
  schulddossier-phpfpm:
    selector:
      app-phpfpm: schulddossier-phpfpm
    ports:
      - port: 8080
        targetPort: http
  schulddossier-nginx:
    selector:
      app-nginx: schulddossier-nginx
    ports:
      - port: 8080
        targetPort: http

ingress:
  schulddossier-nginx-internal:
    className: nginx-internal
    paths:
      - path: /
        service: schulddossier-nginx
        port: 8080